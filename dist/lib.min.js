!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("datocms-client")):"function"==typeof define&&define.amd?define(["exports","datocms-client"],t):t((e=e||self).DatoCMSTools={},e.datocmsClient)}(this,(function(e,t){"use strict";function r(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(r,!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(){return(c=n(regeneratorRuntime.mark((function e(r){var i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.apiKey,a=new t.SiteClient(i),e.next=4,a.itemTypes.all();case 4:return o=e.sent,e.next=7,Promise.all(o.map(function(){var e=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.fields.all(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return s=e.sent,e.abrupt("return",{itemTypes:o,fields:s.flat()});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=n(regeneratorRuntime.mark((function e(r){var i,a,c,p,l,f,d,m,y,v,x,g,h,b,T,w,k,K,R,I,O,P,j,F,S,M,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.apiKey,a=r.models,c=new t.SiteClient(i),p=[],l=[],f=a.itemTypes,d=a.fields,console.log("LULZ"),console.log("LULZ"),console.log(f),console.log("LULZ"),e.next=11,c.itemTypes.all();case 11:return p=e.sent,m=function(e){e.id,e.singletonItem,e.fields,e.titleField,e.orderingField;return s(e,["id","singletonItem","fields","titleField","orderingField"])},y=function(e){e.id,e.position,e.itemType;return s(e,["id","position","itemType"])},v=function(e){var t=f.find((function(t){return t.id===e}));return p.find((function(e){return e.apiKey===t.apiKey})).id},x=function(e,t){var r=d.find((function(t){return t.id===e}));return l.find((function(e){return e.apiKey===r.apiKey&&e.itemType===t.id})).id},e.next=18,Promise.all(p.map(function(){var e=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.fields.all(t.id);case 2:r=e.sent,l=[].concat(u(l),u(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:return e.next=20,Promise.all(f.map(function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.find((function(e){return e.apiKey===t.apiKey})),n=r||t,i=m(t),!r){e.next=10;break}return console.info("itemType ".concat(n.apiKey," already exists, updating...")),e.next=7,c.itemTypes.update(n.id,i);case 7:n=e.sent,e.next=14;break;case 10:return console.info("itemType ".concat(n.apiKey," doesn't exist, creating...")),e.next=13,c.itemTypes.create(i);case 13:n=e.sent;case 14:p=[].concat(u(p),[n]);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:g=function(e){return"slug"!==e.fieldType},h=d.filter(g),b=d.filter((function(e){return!g(e)})),T=[].concat(u(h),u(b)),w=!0,k=!1,K=void 0,e.prev=27,R=regeneratorRuntime.mark((function e(){var t,r,n,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=O.value,r=f.find((function(e){return e.id===t.itemType})),n=p.find((function(e){return e.apiKey===r.apiKey})),i=y(t),a=l.find((function(e){return e.apiKey===t.apiKey&&e.itemType===n.id})),s=a||t,t.validators&&t.validators.richTextBlocks&&t.validators.richTextBlocks.itemTypes&&(i.validators={richTextBlocks:{}},i.validators.richTextBlocks.itemTypes=t.validators.richTextBlocks.itemTypes.map(v)),t.validators&&t.validators.itemsItemType&&t.validators.itemsItemType.itemTypes&&(i.validators={itemsItemType:{}},i.validators.itemsItemType.itemTypes=t.validators.itemsItemType.itemTypes.map(v)),t.validators&&t.validators.itemItemType&&t.validators.itemItemType.itemTypes&&(i.validators={itemItemType:{}},i.validators.itemItemType.itemTypes=t.validators.itemItemType.itemTypes.map(v)),t.validators&&t.validators.slugTitleField&&t.validators.slugTitleField.titleFieldId&&(i.validators=o({},t.validators),i.validators.slugTitleField={titleFieldId:""},i.validators.slugTitleField.titleFieldId=x(t.validators.slugTitleField.titleFieldId,n)),!a){e.next=18;break}return console.info("field ".concat(s.apiKey," already exists, updating ...")),e.next=14,c.fields.update(a.id,i);case 14:s=e.sent,l=l.map((function(e){return e.id===s.id?s:e})),e.next=23;break;case 18:return console.info("field ".concat(s.apiKey," doesn't exist, creating ...")),e.next=21,c.fields.create(n.id,i);case 21:s=e.sent,l=[].concat(u(l),[s]);case 23:case"end":return e.stop()}}),e)})),I=T[Symbol.iterator]();case 30:if(w=(O=I.next()).done){e.next=35;break}return e.delegateYield(R(),"t0",32);case 32:w=!0,e.next=30;break;case 35:e.next=41;break;case 37:e.prev=37,e.t1=e.catch(27),k=!0,K=e.t1;case 41:e.prev=41,e.prev=42,w||null==I.return||I.return();case 44:if(e.prev=44,!k){e.next=47;break}throw K;case 47:return e.finish(44);case 48:return e.finish(41);case 49:P=!0,j=!1,F=void 0,e.prev=52,S=regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=A.value,r=void 0,n=void 0,i=p.find((function(e){return e.apiKey===t.apiKey})),t.titleField&&(a=d.find((function(e){return e.id===t.titleField})).apiKey,r=l.find((function(e){return e.apiKey===a})).id),t.orderingField&&(s=d.find((function(e){return e.id===t.orderingField})).apiKey,n=l.find((function(e){return e.apiKey===s})).id),u=o({},m(i),{titleField:r,orderingField:n}),e.next=9,c.itemTypes.update(i.id,u);case 9:case"end":return e.stop()}}),e)})),M=f[Symbol.iterator]();case 55:if(P=(A=M.next()).done){e.next=60;break}return e.delegateYield(S(),"t2",57);case 57:P=!0,e.next=55;break;case 60:e.next=66;break;case 62:e.prev=62,e.t3=e.catch(52),j=!0,F=e.t3;case 66:e.prev=66,e.prev=67,P||null==M.return||M.return();case 69:if(e.prev=69,!j){e.next=72;break}throw F;case 72:return e.finish(69);case 73:return e.finish(66);case 74:case"end":return e.stop()}}),e,null,[[27,37,41,49],[42,,44,48],[52,62,66,74],[67,,69,73]])})))).apply(this,arguments)}function l(){return(l=n(regeneratorRuntime.mark((function e(r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.apiKey,i=new t.SiteClient(n),e.abrupt("return",i.menuItems.all());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return(f=n(regeneratorRuntime.mark((function e(r){var n,i,a,c,p,l,f,d,m,y,v,x,g,h,b,T,w,k,K;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.apiKey,i=r.menuItems,a=r.models,c=new t.SiteClient(n),e.next=4,c.itemTypes.all();case 4:return p=e.sent,e.next=7,c.menuItems.all();case 7:l=e.sent,f=function(e){e.id;return s(e,["id"])},d=!0,m=!1,y=void 0,e.prev=12,v=regeneratorRuntime.mark((function e(){var t,r,n,i,s,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.value,r=a.itemTypes.find((function(e){return e.id===t.itemType})),n=p.find((function(e){return e.apiKey===r.apiKey})),i=l.find((function(e){return e.itemType===n.id})),s=o({},f(t),{itemType:n.id}),d=i||t,!i){e.next=13;break}return e.next=9,c.menuItems.update(i.id,s);case 9:d=e.sent,l=l.map((function(e){return e.id===d?d:e})),e.next=17;break;case 13:return e.next=15,c.menuItems.create(s);case 15:d=e.sent,l=[].concat(u(i),[d]);case 17:case"end":return e.stop()}}),e)})),x=i[Symbol.iterator]();case 15:if(d=(g=x.next()).done){e.next=20;break}return e.delegateYield(v(),"t0",17);case 17:d=!0,e.next=15;break;case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(12),m=!0,y=e.t1;case 26:e.prev=26,e.prev=27,d||null==x.return||x.return();case 29:if(e.prev=29,!m){e.next=32;break}throw y;case 32:return e.finish(29);case 33:return e.finish(26);case 34:h=!0,b=!1,T=void 0,e.prev=37,w=regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=K.value,r=p.find((function(e){return e.id===t.itemType})),n=a.itemTypes.find((function(e){return e.apiKey===r.apiKey})),o=i.find((function(e){return e.itemType===n.id}))){e.next=7;break}return e.next=7,c.menuItems.destroy(o.id);case 7:case"end":return e.stop()}}),e)})),k=l[Symbol.iterator]();case 40:if(h=(K=k.next()).done){e.next=45;break}return e.delegateYield(w(),"t2",42);case 42:h=!0,e.next=40;break;case 45:e.next=51;break;case 47:e.prev=47,e.t3=e.catch(37),b=!0,T=e.t3;case 51:e.prev=51,e.prev=52,h||null==k.return||k.return();case 54:if(e.prev=54,!b){e.next=57;break}throw T;case 57:return e.finish(54);case 58:return e.finish(51);case 59:case"end":return e.stop()}}),e,null,[[12,22,26,34],[27,,29,33],[37,47,51,59],[52,,54,58]])})))).apply(this,arguments)}function d(){return(d=n(regeneratorRuntime.mark((function e(r){var i,a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.apiKey,a=new t.SiteClient(i),e.next=4,a.items.all();case 4:return o=e.sent,e.next=7,a.menuItems.all();case 7:return s=e.sent,u=function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleting item types..."),e.next=3,a.itemTypes.all();case 3:return t=e.sent,e.abrupt("return",Promise.all(t.map(function(){var e=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.itemTypes.destroy(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=9,console.log("deleting menu items..."),e.next=13,Promise.all(s.map(function(){var e=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.menuItems.destroy(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(9),console.log(e.t0);case 18:return e.prev=18,console.info("deleting items..."),e.next=22,Promise.all(o.map(function(){var e=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.items.destroy(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(18),console.log(e.t1);case 27:c=!1;case 28:return e.prev=28,e.next=31,u();case 31:c=!1,e.next=37;break;case 34:e.prev=34,e.t2=e.catch(28),c=!0;case 37:if(c){e.next=28;break}case 38:case"end":return e.stop()}}),e,null,[[9,15],[18,24],[28,34]])})))).apply(this,arguments)}e.exportMenu=function(e){return l.apply(this,arguments)},e.exportModels=function(e){return c.apply(this,arguments)},e.extractModel=function(e){var t,r=e.apiKeys,n=e.models;if(!r)throw new Error("Must pass at least one name of a model.");if((t=Array.isArray(r)?n.itemTypes.filter((function(e){return r.includes(e.apiKey)})):n.itemTypes.filter((function(e){return e.apiKey===r}))).length<=0)return console.warn("Model not found."),{itemTypes:[],fields:[]};var i=n.fields.filter((function(e){return e.itemType===t[0].id})).map((function(e){var r=e;return r.validators&&r.validators.itemsItemType&&r.validators.itemsItemType.itemTypes&&r.validators.itemsItemType.itemTypes.forEach((function(e){var r=n.itemTypes.find((function(t){return t.id===e}));t=[].concat(u(t),[r])})),r}));return{itemTypes:t,fields:i}},e.importMenu=function(e){return f.apply(this,arguments)},e.importModels=function(e){return p.apply(this,arguments)},e.reset=function(e){return d.apply(this,arguments)},Object.defineProperty(e,"__esModule",{value:!0})}));
